@page "/"
@rendermode InteractiveServer
@inject NavigationManager NavManager
@attribute [AllowAnonymous]

<PageTitle>Nations Converter 2</PageTitle>

<NavMenu Released="released" />
<div class="eyecatcher">
    <h1><img id="logo" src="img/logo.webp" width="700" /></h1>
    <p>Convert your TMS / TMNESWC / TMNF / TMUF / TM2 maps to the latest Trackmania.</p>
</div>
@if (!released)
{
    <div class="web-browser">
        <a href="/login-discord" class="web-browser-button button-shiny"><b>Sign in with Discord to show support</b></a>
    </div>
}
else
{
    <div class="web-browser">
        @if (webAppReleased)
        {
            <p>No need to install anything! Run Nations Converter 2 in a web browser client-side.</p>
            <a href="/webapp" class="web-browser-button button-shiny"><b>Open Nations Converter 2 web</b> (coming early 2025)</a>
        }
        else
        {
            <p>Want to run Nations Converter 2 directly in a web browser? Coming in 2025!</p>
        }
    </div>
    <div class="downloads">
        <div class="readable-width white-mention">
            <div>
                <h2>Download the CLI tool</h2>
                <p>CLI is shipped with <b>common Stadium assets by default</b> (Crystal <b>Classic</b> and <b>Modernized</b>). For other environments, download additional assets.</p>
            </div>
        </div>
        <div class="download-latest">
            <div>
                <h3 class="latest-version">2.0.0-alpha01</h3>
                <div class="download-grid">
                    <div><b>Tool</b></div>
                    <div><b>Assets</b></div>
                    <div style="display: flex; gap: 20px;">
                        <div class="download-button-set">
                            <a href="#" class="button-download-platform button-shiny"><img src="img/windows.svg" width="32" /> <span>Windows</span></a>
                            <div>
                                <a href="#">x64</a>, <a href="#">arm64</a>
                            </div>
                        </div>
                        <div class="download-button-set">
                            <a href="#" class="button-download-platform button-shiny"><img src="img/linux.svg" width="32" /> <span>Linux</span></a>
                            <div>
                                <a href="#">x64</a>, <a href="#">arm64</a>
                            </div>
                        </div>
                    </div>
                    <div class="download-assets">
                        <div class="edition-row">
                            <a href="#" class="button-shiny button-download-assets" style="border-radius: 10px 0 0 0"><img src="img/download.svg" width="16" /> <span>Snow</span></a>
                            <a href="#" class="button-shiny button-download-assets"><img src="img/download.svg" width="16" /> <span>Rally</span></a>
                            <a href="#" class="button-shiny button-download-assets" style="border-radius: 0 10px 0 0"><img src="img/download.svg" width="16" /> <span>Desert</span></a>
                        </div>
                        <div class="edition-row">
                            <a href="#" class="button-shiny button-download-assets"><img src="img/download.svg" width="16" /> <span>Island</span></a>
                            <a href="#" class="button-shiny button-download-assets"><img src="img/download.svg" width="16" /> <span>Bay</span></a>
                            <a href="#" class="button-shiny button-download-assets"><img src="img/download.svg" width="16" /> <span>Coast</span></a>
                        </div>
                        <div class="edition-row">
                            <a href="#" class="button-shiny button-download-assets" style="border-radius: 0 0 10px 10px"><img src="img/download.svg" width="16" /> <span>Stadium (Solid)</span></a>
                        </div>
                    </div>
                    <div style="color: #555;font-size: 70%;">
                        Licensed with AGPL-3.0
                    </div>
                    <div style="color: #555;font-size: 70%;">
                        Free to use for any purpose (CC0)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="open-source readable-width white-mention">
        <div>
            <h2 style="text-align: center">Believe it or not, the tool is open source</h2>
            <a href="#" class="button-github-large"><img src="img/github.svg" width="32" />GitHub</a>
        </div>
    </div>
    <div>
        <div>
            <h2>How does it look like?</h2>
            <div>
                <img />
                <div>
                    <h3>Stadium (category: Crystal, Modernized)</h3>
                    <p>Blocks we made in 2020 were getting a little old. We modernized the Stadium conversion to the 2024 standard.</p>
                </div>
            </div>
            <div>
                <img />
                <div>
                    <h3>Desert (category: Solid, Modless)</h3>
                    <p>The first non-Stadium environment that we ported to Nations Converter.</p>
                </div>
            </div>
            <div>
                <img />
                <div>
                    <h3>Rally (category: Solid, Modless)</h3>
                    <p>Less of a swamp now. Reflective water, remade houses, usage of item trees.</p>
                </div>
            </div>
            <div>
                <img />
                <div>
                    <h3>Snow (category: Solid, Modless)</h3>
                    <p>The most contrasted and overhauled environment in Nations Converter 2.</p>
                </div>
            </div>
            <div>
                <img />
                <div>
                    <h3>Stadium (category: Crystal, Classic)</h3>
                    <p>We brought the same Nations Converter back to with minor improvements, if you're used to it.</p>
                </div>
            </div>
            <div>
                More comparisons coming soon!
            </div>
        </div>
    </div>
    <div class="readable-width">
        <div>
            <h2>Categories</h2>
            <p>Nations Converter 2 is split into many categories, as from the beginning, the tool was supposed to be about choices.</p>
            <h3>Crystal</h3>
            <p>The style of the old Nations Converter. Good old ways of exporting TM2 Stadium Crystal.Gbx and importing it in TM2020.</p>
            <h4>Modernized</h4>
            <p>Improvements to dirt, pool, inflatables, and many other blocks. Presenting more details overall.</p>
            <h4>Classic</h4>
            <p>The old Nations Converter looks from 2020-2022 with minor improvements like usage of pipes and pudding items.</p>
            <h3>Solid</h3>
            <p>You thought 1:1 conversions were impossible?</p>
            <p>We extracted all block meshes from Solid.Gbx files and transformed them into Item.Gbx files!</p>
            <h4>Modless</h4>
            <p>Downloading texture mods suck. We decided to figure out how to make things look good using the TM2020 textures.</p>
            <h4>Mod</h4>
            <p>The equal experience to the old Trackmania games. No compromise in texture usage. To be done.</p>
            <h4>Balanced</h4>
            <p>Mod that looks acceptable when you don't have it downloaded. To be done.</p>
        </div>
    </div>
    <div class="readable-width">
        <div>
            <h2>Authors</h2>
            <div>
                <h3>Development, technology, mesh modeling assistance</h3>
                <p>BigBang1112</p>
            </div>
            <div>
                <h3>Mesh modeling team</h3>
                <p>harry.alexm, Paddy Productions, nod, Zai, eyebo</p>
            </div>
            <div>
                <h3>Mod work</h3>
                <p>Rxelux</p>
            </div>
            <div>
                <h3>Skins</h3>
                <p>DMW</p>
            </div>
            <div>
                <h3>Assistance</h3>
                <p>eyebo</p>
            </div>
        </div>
    </div>
    }

    @code {
    [CascadingParameter] public Task<AuthenticationState>? AuthenticationStateTask { get; set; }

    private bool released = false;
    private bool webAppReleased = false;

    protected override async Task OnInitializedAsync()
    {
        if (AuthenticationStateTask is null)
        {
            return;
        }

        var authState = await AuthenticationStateTask;
        if (authState.User.Identity?.IsAuthenticated == true)
        {
            if (authState.User.IsInRole("Admin") || authState.User.IsInRole("Developer") || authState.User.IsInRole("Modeler"))
            {
                NavManager.NavigateTo("/dashboard");
            }
            else
            {
                NavManager.NavigateTo("/thank-you");
            }
        }
    }
}